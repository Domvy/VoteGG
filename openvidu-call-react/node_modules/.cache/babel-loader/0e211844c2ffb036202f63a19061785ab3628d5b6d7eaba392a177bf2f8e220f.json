{"ast":null,"code":"import React,{Component}from'react';import IconButton from'@material-ui/core/IconButton';import Fab from'@material-ui/core/Fab';import HighlightOff from'@material-ui/icons/HighlightOff';import Send from'@material-ui/icons/Send';import'./ChatComponent.css';import{Tooltip}from'@material-ui/core';export default class ChatComponent extends Component{constructor(props){super(props);this.state={messageList:[],message:''};this.chatScroll=/*#__PURE__*/React.createRef();this.handleChange=this.handleChange.bind(this);this.handlePressKey=this.handlePressKey.bind(this);this.close=this.close.bind(this);this.sendMessage=this.sendMessage.bind(this);}componentDidMount(){this.props.user.getStreamManager().stream.session.on('signal:chat',event=>{const data=JSON.parse(event.data);let messageList=this.state.messageList;messageList.push({connectionId:event.from.connectionId,nickname:data.nickname,message:data.message});const document=window.document;setTimeout(()=>{const userImg=document.getElementById('userImg-'+(this.state.messageList.length-1));const video=document.getElementById('video-'+data.streamId);const avatar=userImg.getContext('2d');avatar.drawImage(video,200,120,285,285,0,0,60,60);this.props.messageReceived();},50);this.setState({messageList:messageList});this.scrollToBottom();});}handleChange(event){this.setState({message:event.target.value});}handlePressKey(event){if(event.key==='Enter'){this.sendMessage();}}sendMessage(){console.log(this.state.message);if(this.props.user&&this.state.message){let message=this.state.message.replace(/ +(?= )/g,'');if(message!==''&&message!==' '){const data={message:message,nickname:this.props.user.getNickname(),streamId:this.props.user.getStreamManager().stream.streamId};this.props.user.getStreamManager().stream.session.signal({data:JSON.stringify(data),type:'chat'});}}this.setState({message:''});}scrollToBottom(){setTimeout(()=>{try{this.chatScroll.current.scrollTop=this.chatScroll.current.scrollHeight;}catch(err){}},20);}close(){this.props.close(undefined);}render(){const styleChat={display:this.props.chatDisplay};return/*#__PURE__*/React.createElement(\"div\",{id:\"chatContainer\"},/*#__PURE__*/React.createElement(\"div\",{id:\"chatComponent\",style:styleChat},/*#__PURE__*/React.createElement(\"div\",{id:\"chatToolbar\"},/*#__PURE__*/React.createElement(\"span\",null,this.props.user.getStreamManager().stream.session.sessionId,\" - CHAT\"),/*#__PURE__*/React.createElement(IconButton,{id:\"closeButton\",onClick:this.close},/*#__PURE__*/React.createElement(HighlightOff,{color:\"secondary\"}))),/*#__PURE__*/React.createElement(\"div\",{className:\"message-wrap\",ref:this.chatScroll},this.state.messageList.map((data,i)=>/*#__PURE__*/React.createElement(\"div\",{key:i,id:\"remoteUsers\",className:'message'+(data.connectionId!==this.props.user.getConnectionId()?' left':' right')},/*#__PURE__*/React.createElement(\"canvas\",{id:'userImg-'+i,width:\"60\",height:\"60\",className:\"user-img\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"msg-detail\"},/*#__PURE__*/React.createElement(\"div\",{className:\"msg-info\"},/*#__PURE__*/React.createElement(\"p\",null,\" \",data.nickname)),/*#__PURE__*/React.createElement(\"div\",{className:\"msg-content\"},/*#__PURE__*/React.createElement(\"span\",{className:\"triangle\"}),/*#__PURE__*/React.createElement(\"p\",{className:\"text\"},data.message)))))),/*#__PURE__*/React.createElement(\"div\",{id:\"messageInput\"},/*#__PURE__*/React.createElement(\"input\",{placeholder:\"Send a messge\",id:\"chatInput\",value:this.state.message,onChange:this.handleChange,onKeyPress:this.handlePressKey}),/*#__PURE__*/React.createElement(Tooltip,{title:\"Send message\"},/*#__PURE__*/React.createElement(Fab,{size:\"small\",id:\"sendButton\",onClick:this.sendMessage},/*#__PURE__*/React.createElement(Send,null))))));}}","map":{"version":3,"names":["React","Component","IconButton","Fab","HighlightOff","Send","Tooltip","ChatComponent","constructor","props","state","messageList","message","chatScroll","createRef","handleChange","bind","handlePressKey","close","sendMessage","componentDidMount","user","getStreamManager","stream","session","on","event","data","JSON","parse","push","connectionId","from","nickname","document","window","setTimeout","userImg","getElementById","length","video","streamId","avatar","getContext","drawImage","messageReceived","setState","scrollToBottom","target","value","key","console","log","replace","getNickname","signal","stringify","type","current","scrollTop","scrollHeight","err","undefined","render","styleChat","display","chatDisplay","createElement","id","style","sessionId","onClick","color","className","ref","map","i","getConnectionId","width","height","placeholder","onChange","onKeyPress","title","size"],"sources":["/home/ubuntu/Project-Agora/openvidu-call-react/src/components/chat/ChatComponent.js"],"sourcesContent":["import React, { Component } from 'react';\nimport IconButton from '@material-ui/core/IconButton';\nimport Fab from '@material-ui/core/Fab';\nimport HighlightOff from '@material-ui/icons/HighlightOff';\nimport Send from '@material-ui/icons/Send';\n\nimport './ChatComponent.css';\nimport { Tooltip } from '@material-ui/core';\n\nexport default class ChatComponent extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            messageList: [],\n            message: '',\n        };\n        this.chatScroll = React.createRef();\n\n        this.handleChange = this.handleChange.bind(this);\n        this.handlePressKey = this.handlePressKey.bind(this);\n        this.close = this.close.bind(this);\n        this.sendMessage = this.sendMessage.bind(this);\n    }\n\n\n    componentDidMount() {\n        this.props.user.getStreamManager().stream.session.on('signal:chat', (event) => {\n            const data = JSON.parse(event.data);\n            let messageList = this.state.messageList;\n            messageList.push({ connectionId: event.from.connectionId, nickname: data.nickname, message: data.message });\n            const document = window.document;\n            setTimeout(() => {\n                const userImg = document.getElementById('userImg-' + (this.state.messageList.length - 1));\n                const video = document.getElementById('video-' + data.streamId);\n                const avatar = userImg.getContext('2d');\n                avatar.drawImage(video, 200, 120, 285, 285, 0, 0, 60, 60);\n                this.props.messageReceived();\n            }, 50);\n            this.setState({ messageList: messageList });\n            this.scrollToBottom();\n        });\n    }\n\n    handleChange(event) {\n        this.setState({ message: event.target.value });\n    }\n\n    handlePressKey(event) {\n        if (event.key === 'Enter') {\n            this.sendMessage();\n        }\n    }\n\n    sendMessage() {\n        console.log(this.state.message);\n        if (this.props.user && this.state.message) {\n            let message = this.state.message.replace(/ +(?= )/g, '');\n            if (message !== '' && message !== ' ') {\n                const data = { message: message, nickname: this.props.user.getNickname(), streamId: this.props.user.getStreamManager().stream.streamId };\n                this.props.user.getStreamManager().stream.session.signal({\n                    data: JSON.stringify(data),\n                    type: 'chat',\n                });\n            }\n        }\n        this.setState({ message: '' });\n    }\n\n    scrollToBottom() {\n        setTimeout(() => {\n            try {\n                this.chatScroll.current.scrollTop = this.chatScroll.current.scrollHeight;\n            } catch (err) {}\n        }, 20);\n    }\n\n    close() {\n        this.props.close(undefined);\n    }\n\n    render() {\n        const styleChat = { display: this.props.chatDisplay };\n        return (\n            <div id=\"chatContainer\">\n                <div id=\"chatComponent\" style={styleChat}>\n                    <div id=\"chatToolbar\">\n                        <span>{this.props.user.getStreamManager().stream.session.sessionId} - CHAT</span>\n                        <IconButton id=\"closeButton\" onClick={this.close}>\n                            <HighlightOff color=\"secondary\" />\n                        </IconButton>\n                    </div>\n                    <div className=\"message-wrap\" ref={this.chatScroll}>\n                        {this.state.messageList.map((data, i) => (\n                            <div\n                                key={i}\n                                id=\"remoteUsers\"\n                                className={\n                                    'message' + (data.connectionId !== this.props.user.getConnectionId() ? ' left' : ' right')\n                                }\n                            >\n                                <canvas id={'userImg-' + i} width=\"60\" height=\"60\" className=\"user-img\" />\n                                <div className=\"msg-detail\">\n                                    <div className=\"msg-info\">\n                                        <p> {data.nickname}</p>\n                                    </div>\n                                    <div className=\"msg-content\">\n                                        <span className=\"triangle\" />\n                                        <p className=\"text\">{data.message}</p>\n                                    </div>\n                                </div>\n                            </div>\n                        ))}\n                    </div>\n\n                    <div id=\"messageInput\">\n                        <input\n                            placeholder=\"Send a messge\"\n                            id=\"chatInput\"\n                            value={this.state.message}\n                            onChange={this.handleChange}\n                            onKeyPress={this.handlePressKey}\n                        />\n                        <Tooltip title=\"Send message\">\n                            <Fab size=\"small\" id=\"sendButton\" onClick={this.sendMessage}>\n                                <Send />\n                            </Fab>\n                        </Tooltip>\n                    </div>\n                </div>\n            </div>\n        );\n    }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}